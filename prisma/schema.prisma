generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  MEMBER
  OWNER
}

enum Provider {
  PASSWORD
  GOOGLE
}

enum UserRole {
  CUSTOMER
  ADMIN
  DRIVER
}

model User {
  id               String    @id @default(uuid())
  hubspotId        String?
  email            String    @unique
  imageUrl         String?
  stripeCustomerId String?
  name             String
  password         String?
  provider         Provider  @default(PASSWORD)
  role             Role      @default(OWNER)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  deletedAt        DateTime?

  members           Member[]
  transactions      Transaction[]
  organizationUsers OrganizationUser[]
}

enum OrganizationUserRole {
  ADMINISTRATOR
}

model Invitation {
  id             String               @id @default(uuid())
  email          String
  organizationId String
  role           OrganizationUserRole
  token          String
  acceptedAt     DateTime?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  deletedAt      DateTime?

  organization Organization @relation(fields: [organizationId], references: [id])
}

model OrganizationUser {
  id             String               @id @default(uuid())
  organizationId String
  userId         String
  role           OrganizationUserRole @default(ADMINISTRATOR)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  deletedAt      DateTime?

  organization Organization @relation(fields: [organizationId], references: [id])
  user         User         @relation(fields: [userId], references: [id])
}

model Member {
  id                  String       @id @default(uuid())
  user                User?        @relation(fields: [userId], references: [id])
  userId              String?      @unique
  addressId           String?
  phoneNumber         String?
  note                String       @default("")
  email               String?
  firstName           String
  lastName            String       @default("")
  organizationId      String
  imageUrl            String?
  organization        Organization @relation(fields: [organizationId], references: [id])
  membershipExpiresAt DateTime?
  formattedAddress    String?
  isMembershipActive  Boolean      @default(true)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  deletedAt           DateTime?

  address  Address?  @relation(fields: [addressId], references: [id])
  commands Command[]
}

model Organization {
  id                String  @id @default(uuid())
  name              String
  addressId         String?
  description       String?
  imageUrl          String?
  imageCardBackUrl  String?
  imageCardFrontUrl String?
  formattedAddress  String?

  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  deletedAt         DateTime?
  address           Address?           @relation(fields: [addressId], references: [id])
  organizationUsers OrganizationUser[]
  members           Member[]
  invitations       Invitation[]
}

model Address {
  id               String         @id @default(uuid())
  unit             String?
  formattedAddress String
  streetNumber     String?
  streetName       String?
  city             String?
  region           String?
  postalCode       String?
  country          String
  latitude         Float
  longitude        Float
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  deletedAt        DateTime?
  members          Member[]
  organizations    Organization[]
}

enum TransactionStatus {
  PENDING
  SUCCEEDED
  FAILED
}

model Transaction {
  id                    String            @id @default(uuid())
  userId                String
  user                  User              @relation(fields: [userId], references: [id])
  amount                Float
  currency              String            @default("EUR")
  stripeSessionId       String
  stripePaymentIntentId String?
  status                TransactionStatus @default(PENDING)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  deletedAt             DateTime?

  command Command?
}

enum CommandStatus {
  PENDING
  SUCCEEDED
  FAILED
}

model Command {
  id            String        @id @default(uuid())
  transactionId String        @unique
  memberId      String
  status        CommandStatus @default(PENDING)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  transaction Transaction @relation(fields: [transactionId], references: [id])
  member      Member      @relation(fields: [memberId], references: [id])
}
